

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>App Harvesting &mdash; Tethys Platform 0.1.0 documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  
    <link rel="top" title="Tethys Platform 0.1.0 documentation" href="index.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        
          <a href="index.html" class="fa fa-home"> Tethys Platform</a>
        
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
        
            <ul>
<li class="toctree-l1"><a class="reference internal" href="features.html">Tethys Platform</a><ul>
<li class="toctree-l2"><a class="reference internal" href="features.html#develop-web-apps">Develop Web Apps</a></li>
<li class="toctree-l2"><a class="reference internal" href="features.html#python-software-development-kit">Python Software Development Kit</a></li>
<li class="toctree-l2"><a class="reference internal" href="features.html#templating-and-gizmos">Templating and Gizmos</a></li>
<li class="toctree-l2"><a class="reference internal" href="features.html#spatial-data">Spatial Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="features.html#data-store">Data Store</a></li>
<li class="toctree-l2"><a class="reference internal" href="features.html#computing">Computing</a></li>
<li class="toctree-l2"><a class="reference internal" href="features.html#developer-tools">Developer Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="features.html#production-ready">Production Ready</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="installation.html#install-the-dependencies">1. Install the Dependencies</a></li>
<li class="toctree-l2"><a class="reference internal" href="installation.html#install-advanced-dependencies">2. Install Advanced Dependencies</a></li>
<li class="toctree-l2"><a class="reference internal" href="installation.html#create-virtual-environment-and-install-tethys-platform">3. Create Virtual Environment and Install Tethys Platform</a></li>
<li class="toctree-l2"><a class="reference internal" href="installation.html#create-database-and-database-users">4. Create Database and Database Users</a></li>
<li class="toctree-l2"><a class="reference internal" href="installation.html#create-settings-file-and-configure-settings">5. Create Settings File and Configure Settings</a></li>
<li class="toctree-l2"><a class="reference internal" href="installation.html#create-database-tables">6. Create Database Tables</a></li>
<li class="toctree-l2"><a class="reference internal" href="installation.html#start-up-the-django-development-server">7. Start up the Django Development Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="installation.html#what-s-next">What&#8217;s Next?</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting Started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="getting_started/scaffold.html">Generate New App with Scaffold</a></li>
<li class="toctree-l2"><a class="reference internal" href="getting_started/persistent_stores.html">The Model and Persistent Stores</a></li>
<li class="toctree-l2"><a class="reference internal" href="getting_started/view.html">The View and Templating</a></li>
<li class="toctree-l2"><a class="reference internal" href="getting_started/controller.html">Working with the Controller</a></li>
<li class="toctree-l2"><a class="reference internal" href="getting_started/url_mapping.html">URL Mapping</a></li>
<li class="toctree-l2"><a class="reference internal" href="getting_started/forms.html">Working with Form Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="getting_started/configuration.html">Configuring Apps</a></li>
<li class="toctree-l2"><a class="reference internal" href="getting_started/distribution.html">Distributing Apps</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="tethys_api.html">Tethys Software Development Kit</a><ul>
<li class="toctree-l2"><a class="reference internal" href="tethys_api/dataset_services.html">Dataset Services API</a></li>
<li class="toctree-l2"><a class="reference internal" href="tethys_api/spatial_database.html">Persistent Stores</a></li>
<li class="toctree-l2"><a class="reference internal" href="tethys_api/spatial_publishing.html">Spatial Data Publishing</a></li>
<li class="toctree-l2"><a class="reference internal" href="tethys_api/geoprocessing.html">Geoprocessing</a></li>
<li class="toctree-l2"><a class="reference internal" href="tethys_api/visualizing.html">Data Visualization</a></li>
<li class="toctree-l2"><a class="reference internal" href="tethys_api/cloud_computing.html">High Performance Computing</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="reference.html">Summary of References</a></li>
<li class="toctree-l1"><a class="reference internal" href="glossary.html">Glossary</a></li>
</ul>

        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">Tethys Platform</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>App Harvesting</li>
      <li class="wy-breadcrumbs-aside">
        
          <a href="_sources/app_harvesting.txt" rel="nofollow"> View page source</a>
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <div class="section" id="app-harvesting">
<h1>App Harvesting<a class="headerlink" href="#app-harvesting" title="Permalink to this headline">¶</a></h1>
<p><strong>Last Updated:</strong> May 20, 2014</p>
<p>The Tethys Apps plugin requires app projects to conform to a specific file structure. To understand why the structure of an apps project is important, it is useful to know how apps are loaded into CKAN by the Tethys Apps plugin.</p>
<p>Apps are loaded when the CKAN server starts up by a process called App Harvesting (see <a class="reference internal" href="#harvest-figure-1"><em>Figure 1. The app harvesting process.</em></a>). This task is performed by an instance of the <tt class="docutils literal"><span class="pre">SingletonAppHarvester</span></tt> class called the <a class="reference internal" href="glossary.html#term-app-harvester"><em class="xref std std-term">app harvester</em></a>. When CKAN loads, the Tethys Apps plugin creates a new <a class="reference internal" href="glossary.html#term-app-harvester"><em class="xref std std-term">app harvester</em></a>. The <a class="reference internal" href="glossary.html#term-app-harvester"><em class="xref std std-term">app harvester</em></a> walks through each of the <a class="reference internal" href="glossary.html#term-app-packages"><em class="xref std std-term">app packages</em></a> in the <tt class="file docutils literal"><span class="pre">ckanapp</span></tt> directory and locates the app configuration file (<tt class="file docutils literal"><span class="pre">app.py</span></tt>). This file contains the information that CKAN needs to load the app.</p>
<p>After the <a class="reference internal" href="glossary.html#term-app-harvester"><em class="xref std std-term">app harvester</em></a> has located all of the app configuration files, it creates an instance each class, which will be referred to as <a class="reference internal" href="glossary.html#term-app-instances"><em class="xref std std-term">app instances</em></a>, hereafter. The <a class="reference internal" href="glossary.html#term-app-harvester"><em class="xref std std-term">app harvester</em></a> calls all of the methods of each <a class="reference internal" href="glossary.html#term-app-instance"><em class="xref std std-term">app instance</em></a> and passes itself as the only argument. These methods pass information about the app to the <a class="reference internal" href="glossary.html#term-app-harvester"><em class="xref std std-term">app harvester</em></a>. Finally, the Tethys Apps plugin uses the information the <a class="reference internal" href="glossary.html#term-app-harvester"><em class="xref std std-term">app harvester</em></a> has collected from the apps to load the apps into CKAN.</p>
<div class="figure" id="harvest-figure-1">
<img alt="diagram of app harvesting process" src="_images/app_harvest.png" />
<p class="caption"><strong>Figure 1. The app harvesting process.</strong></p>
</div>
<div class="section" id="appbase-class">
<h2>AppBase Class<a class="headerlink" href="#appbase-class" title="Permalink to this headline">¶</a></h2>
<p>The app harvesting process is made to mimic the process by which plugins for CKAN are written. The <a class="reference internal" href="glossary.html#term-app-class"><em class="xref std std-term">app class</em></a> is implemented in <tt class="file docutils literal"><span class="pre">app.py</span></tt> is an instance of the <tt class="docutils literal"><span class="pre">AppBase</span></tt> class that is provided by the Tethys Apps plugin. The data that is declared in this the <a class="reference internal" href="glossary.html#term-app-class"><em class="xref std std-term">app class</em></a> and collected by the <a class="reference internal" href="glossary.html#term-app-harvester"><em class="xref std std-term">app harvester</em></a> is eventually passed as parameters to the CKAN plugin interface methods of the Tethys Apps plugin. <a class="reference internal" href="#harvest-figure-2"><em>Figure 2. Comparison of a CKAN Plugin class and a Tethys App class.</em></a> shows how app classes and CKAN classes mirror each other.</p>
<div class="figure" id="harvest-figure-2">
<img alt="comparison of the CKAN plugin class and a Tethys Apps class" src="_images/mirror_comparison.png" />
<p class="caption"><strong>Figure 2. Comparison of a CKAN Plugin class and a Tethys App class.</strong></p>
</div>
<p>As an example, compare the <tt class="docutils literal"><span class="pre">after_map</span></tt> plugin method and the <tt class="docutils literal"><span class="pre">registerController</span></tt> app method. The <tt class="docutils literal"><span class="pre">registerController</span></tt> method receives the <a class="reference internal" href="glossary.html#term-app-harvester"><em class="xref std std-term">app harvester</em></a> and calls <tt class="docutils literal"><span class="pre">addControllers</span></tt> on it to add the appropriate parameters to map a controller in Pylons. The Tethys Apps plugin <tt class="docutils literal"><span class="pre">after_map</span></tt> class is given the <tt class="docutils literal"><span class="pre">map</span></tt> object that is used to map all of the controllers for the CKAN site. The plugin class retrieves the controller information collected by the harvester and passes it as parameters to the <tt class="docutils literal"><span class="pre">connect</span></tt> method of <tt class="docutils literal"><span class="pre">map</span></tt>.</p>
<p>In summary, the purpose these mirror methods of the <a class="reference internal" href="glossary.html#term-app-class"><em class="xref std std-term">app class</em></a> in <tt class="file docutils literal"><span class="pre">app.py</span></tt> is to collect the data that the Tethys Apps plugin needs to connect the app to CKAN. The <a class="reference internal" href="glossary.html#term-app-harvester"><em class="xref std std-term">app harvester</em></a> aggregates all of this information from all of the <a class="reference internal" href="glossary.html#term-app-instances"><em class="xref std std-term">app instances</em></a> and passes it along to the Tethys Apps plugin. More detail will be given about the structure of app projects and the <tt class="file docutils literal"><span class="pre">app.py</span></tt> class in a later section.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Only the methods that are mirrored between a plugin class and an app class are shown in <a class="reference internal" href="#harvest-figure-2"><em>Figure 2. Comparison of a CKAN Plugin class and a Tethys App class.</em></a>. Both classes have other methods that are not related that are not shown.</p>
</div>
</div>
</div>


          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2014, Nathan Swain.
    </p>
  </div>

  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.1.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>